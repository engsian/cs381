<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 7: Authentication, Authorization & Security - CS381</title>

    <!-- Reveal.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/theme/white.min.css">

    <!-- Highlight.js for code -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom Theme Override -->
    <link rel="stylesheet" href="css/theme.css">

    <style>
        .home-nav {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        .home-nav a {
            background: #f8fafc;
            color: #64748b;
            padding: 0.5em 1em;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5em;
        }
        .home-nav a:hover {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.6em;
            margin: 0.5em 0;
        }
        .feature-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 0.8em;
            text-align: center;
        }
        .feature-card i {
            font-size: 1.5em;
            color: #dc2626;
            margin-bottom: 0.3em;
            display: block;
        }
        .feature-card h4 {
            margin: 0.3em 0;
            font-size: 0.8em;
        }
        .feature-card p {
            font-size: 0.65em;
            color: #64748b;
            margin: 0;
        }
        .thinking-card {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-left: 4px solid #dc2626;
            padding: 0.8em;
            border-radius: 0 10px 10px 0;
            margin: 0.5em 0;
            text-align: left;
        }
        .thinking-card p {
            margin: 0;
            font-size: 0.85em;
        }
        .warning-card {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 0.8em;
            border-radius: 0 10px 10px 0;
            margin: 0.5em 0;
            text-align: left;
        }
        .warning-card p {
            margin: 0;
            font-size: 0.85em;
        }
        .success-card {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 0.8em;
            border-radius: 0 10px 10px 0;
            margin: 0.5em 0;
            text-align: left;
        }
        .success-card p {
            margin: 0;
            font-size: 0.85em;
        }
        .attack-card {
            background: #1e293b;
            color: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid #dc2626;
        }
        .attack-card li {
            color: #e2e8f0 !important;
        }
        .defense-card {
            background: #f0fdf4;
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid #22c55e;
        }
        .owasp-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.4rem;
        }
        .owasp-num {
            background: #dc2626;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- Home Navigation -->
    <div class="home-nav">
        <a href="index.html"><i class="fas fa-home"></i> Home</a>
    </div>

    <div class="reveal">
        <div class="slides">
            <!-- Title Slide -->
            <section data-background-color="#f8fafc">
                <h1 style="color: #dc2626;">Module 7</h1>
                <h2>Authentication, Authorization & Security</h2>
                <p style="color: #64748b;">Protecting Your Web Applications</p>
                <p style="font-size: 0.5em; margin-top: 2em; color: #94a3b8;">CS381 - Web Application Development</p>
            </section>

            <!-- Learning Objectives -->
            <section>
                <h2>Learning Objectives</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <i class="fas fa-user-check"></i>
                        <h4>Authentication</h4>
                        <p>Verify user identity</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-user-shield"></i>
                        <h4>Authorization</h4>
                        <p>Control access permissions</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-key"></i>
                        <h4>Password Security</h4>
                        <p>Hashing and verification</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-sign-in-alt"></i>
                        <h4>Login Systems</h4>
                        <p>Build secure authentication</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-bug"></i>
                        <h4>OWASP Top 10</h4>
                        <p>Common vulnerabilities</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-shield-alt"></i>
                        <h4>Best Practices</h4>
                        <p>Secure coding techniques</p>
                    </div>
                </div>
            </section>

            <!-- Authentication vs Authorization -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-id-card" style="color: #dc2626;"></i> Authentication vs Authorization</h2>
                <p style="font-size: 0.85em;">Two different security concepts</p>
            </section>

            <section>
                <h2>Authentication vs Authorization</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; font-size: 0.6em;">
                    <div style="background: #dbeafe; padding: 1.25rem; border-radius: 0.5rem; border-top: 4px solid #2563eb;">
                        <h3 style="margin: 0 0 0.5rem 0; color: #2563eb;"><i class="fas fa-user-check"></i> Authentication</h3>
                        <p style="font-weight: bold; margin: 0 0 0.75rem 0;">"Who are you?"</p>
                        <ul style="margin: 0; line-height: 1.7;">
                            <li>Verifies identity</li>
                            <li>Login with credentials</li>
                            <li>Proves you are who you claim</li>
                            <li>Example: Username + Password</li>
                        </ul>
                    </div>
                    <div style="background: #f0fdf4; padding: 1.25rem; border-radius: 0.5rem; border-top: 4px solid #22c55e;">
                        <h3 style="margin: 0 0 0.5rem 0; color: #22c55e;"><i class="fas fa-user-shield"></i> Authorization</h3>
                        <p style="font-weight: bold; margin: 0 0 0.75rem 0;">"What can you do?"</p>
                        <ul style="margin: 0; line-height: 1.7;">
                            <li>Controls access rights</li>
                            <li>Permissions and roles</li>
                            <li>Determines allowed actions</li>
                            <li>Example: Admin vs User</li>
                        </ul>
                    </div>
                </div>
                <div class="thinking-card" style="margin-top: 1rem;">
                    <p style="font-size: 0.75em;"><strong>Real-world analogy:</strong> Your ID badge (authentication) gets you into the building. Your role (authorization) determines which rooms you can access.</p>
                </div>
            </section>

            <section>
                <h2>Authentication Flow</h2>
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.3rem; font-size: 0.5em; margin-bottom: 1rem;">
                    <div style="background: #dbeafe; padding: 0.6rem 0.8rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-user" style="font-size: 1.5em; color: #2563eb;"></i><br>
                        <strong>User</strong><br>
                        Enters credentials
                    </div>
                    <i class="fas fa-arrow-right" style="color: #64748b;"></i>
                    <div style="background: #fef3c7; padding: 0.6rem 0.8rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-server" style="font-size: 1.5em; color: #f59e0b;"></i><br>
                        <strong>Server</strong><br>
                        Verifies password
                    </div>
                    <i class="fas fa-arrow-right" style="color: #64748b;"></i>
                    <div style="background: #f3e8ff; padding: 0.6rem 0.8rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-ticket-alt" style="font-size: 1.5em; color: #8b5cf6;"></i><br>
                        <strong>Session</strong><br>
                        Created on success
                    </div>
                    <i class="fas fa-arrow-right" style="color: #64748b;"></i>
                    <div style="background: #dcfce7; padding: 0.6rem 0.8rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-check-circle" style="font-size: 1.5em; color: #22c55e;"></i><br>
                        <strong>Access</strong><br>
                        Granted
                    </div>
                </div>
                <pre style="font-size: 0.45em;"><code class="php">// Simplified authentication flow
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $user = findUserByEmail($_POST['email']);

    if ($user && password_verify($_POST['password'], $user['password'])) {
        // Authentication successful
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['logged_in'] = true;
        header('Location: dashboard.php');
    } else {
        $error = 'Invalid email or password';
    }
}</code></pre>
            </section>

            <!-- Password Security -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-key" style="color: #dc2626;"></i> Password Security</h2>
                <p style="font-size: 0.85em;">Never store passwords in plain text!</p>
            </section>

            <section>
                <h2>Why Hash Passwords?</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.6em; margin-bottom: 1rem;">
                    <div class="attack-card">
                        <h4 style="margin: 0 0 0.5rem 0; color: #f87171;"><i class="fas fa-skull-crossbones"></i> Plain Text Storage</h4>
                        <pre style="font-size: 0.85em; margin: 0.5rem 0; background: #0f172a; padding: 0.5rem; border-radius: 4px;"><code class="nohighlight">id | email           | password
1  | ahmed@test.com  | secret123
2  | sara@test.com   | mypass456</code></pre>
                        <p style="margin: 0.5rem 0 0 0; color: #fca5a5;">If database is breached, ALL passwords exposed!</p>
                    </div>
                    <div class="defense-card">
                        <h4 style="margin: 0 0 0.5rem 0; color: #22c55e;"><i class="fas fa-shield-alt"></i> Hashed Storage</h4>
                        <pre style="font-size: 0.85em; margin: 0.5rem 0; background: #f8fafc; padding: 0.5rem; border-radius: 4px;"><code class="nohighlight">id | email           | password
1  | ahmed@test.com  | $2y$10$xK3...
2  | sara@test.com   | $2y$10$mN7...</code></pre>
                        <p style="margin: 0.5rem 0 0 0; color: #166534;">Passwords cannot be reversed from hash!</p>
                    </div>
                </div>
                <div class="thinking-card">
                    <p style="font-size: 0.75em;"><strong>Key concept:</strong> Hashing is one-way. You can convert password → hash, but you cannot convert hash → password.</p>
                </div>
            </section>

            <section>
                <h2>PHP Password Functions</h2>
                <pre style="font-size: 0.5em;"><code class="php">&lt;?php
// HASHING - When user registers or changes password
$password = 'user_password_123';
$hash = password_hash($password, PASSWORD_DEFAULT);
// Result: $2y$10$xK3nF8vQmJ7...  (60+ characters)

// Store $hash in database, NEVER the plain password!

// VERIFYING - When user logs in
$inputPassword = $_POST['password'];  // User's login attempt
$storedHash = $user['password'];      // Hash from database

if (password_verify($inputPassword, $storedHash)) {
    echo "Password correct!";
} else {
    echo "Invalid password!";
}
?&gt;</code></pre>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.6em; margin-top: 0.75rem;">
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem;">
                        <strong><code>password_hash()</code></strong><br>
                        Creates secure hash with random salt
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem;">
                        <strong><code>password_verify()</code></strong><br>
                        Compares password against hash
                    </div>
                </div>
            </section>

            <section>
                <h2>Password Hashing Best Practices</h2>
                <div style="font-size: 0.65em; text-align: left; max-width: 750px; margin: 0 auto;">
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-top: 0.2rem;"></i>
                        <div><strong>Use PASSWORD_DEFAULT</strong> — automatically uses the strongest algorithm</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-top: 0.2rem;"></i>
                        <div><strong>Never use MD5 or SHA1</strong> — they're fast, which is bad for passwords</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-top: 0.2rem;"></i>
                        <div><strong>Store hash in VARCHAR(255)</strong> — future algorithms may produce longer hashes</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-top: 0.2rem;"></i>
                        <div><strong>Require strong passwords</strong> — minimum 8 characters, mixed case, numbers</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="fas fa-check-circle" style="color: #22c55e; margin-top: 0.2rem;"></i>
                        <div><strong>Use password_needs_rehash()</strong> — upgrade hashes when algorithm changes</div>
                    </div>
                </div>
                <pre style="font-size: 0.45em; margin-top: 0.75rem;"><code class="php">// Check if hash needs upgrading (after login)
if (password_needs_rehash($storedHash, PASSWORD_DEFAULT)) {
    $newHash = password_hash($inputPassword, PASSWORD_DEFAULT);
    // Update hash in database
}</code></pre>
            </section>

            <!-- Building a Login System -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-sign-in-alt" style="color: #dc2626;"></i> Building a Login System</h2>
                <p style="font-size: 0.85em;">Complete authentication implementation</p>
            </section>

            <section>
                <h2>Users Table Structure</h2>
                <pre style="font-size: 0.5em;"><code class="sql">CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    role ENUM('user', 'admin') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Example: Insert admin user (password: admin123)
INSERT INTO users (email, password, name, role) VALUES (
    'admin@example.com',
    '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi',
    'Administrator',
    'admin'
);</code></pre>
                <div class="thinking-card">
                    <p style="font-size: 0.75em;"><strong>Note:</strong> The password field is VARCHAR(255) to accommodate future algorithm changes. Current bcrypt produces ~60 characters.</p>
                </div>
            </section>

            <section>
                <h2>Registration Form</h2>
                <pre style="font-size: 0.4em;"><code class="php">&lt;?php // register.php
require_once 'db.php';
$errors = [];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $name = trim($_POST['name']);
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    $confirm = $_POST['confirm_password'];

    // Validation
    if (empty($name)) $errors[] = 'Name is required';
    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) $errors[] = 'Invalid email';
    if (strlen($password) < 8) $errors[] = 'Password must be at least 8 characters';
    if ($password !== $confirm) $errors[] = 'Passwords do not match';

    // Check if email exists
    $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
    $stmt->execute([$email]);
    if ($stmt->fetch()) $errors[] = 'Email already registered';

    if (empty($errors)) {
        $hash = password_hash($password, PASSWORD_DEFAULT);
        $stmt = $pdo->prepare("INSERT INTO users (name, email, password) VALUES (?, ?, ?)");
        $stmt->execute([$name, $email, $hash]);
        header('Location: login.php?registered=1');
        exit();
    }
}
?&gt;</code></pre>
            </section>

            <section>
                <h2>Login Form</h2>
                <pre style="font-size: 0.4em;"><code class="php">&lt;?php // login.php
session_start();
require_once 'db.php';
$error = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $password = $_POST['password'];

    // Find user by email
    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$email]);
    $user = $stmt->fetch();

    // Verify password
    if ($user && password_verify($password, $user['password'])) {
        // Regenerate session ID to prevent session fixation
        session_regenerate_id(true);

        // Store user info in session
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['user_name'] = $user['name'];
        $_SESSION['user_role'] = $user['role'];
        $_SESSION['logged_in'] = true;

        header('Location: dashboard.php');
        exit();
    } else {
        $error = 'Invalid email or password';  // Don't reveal which is wrong!
    }
}
?&gt;</code></pre>
            </section>

            <section>
                <h2>Protected Page</h2>
                <pre style="font-size: 0.48em;"><code class="php">&lt;?php // dashboard.php
session_start();

// Check if user is logged in
if (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true) {
    header('Location: login.php');
    exit();
}

// User is authenticated - show protected content
$userName = htmlspecialchars($_SESSION['user_name']);
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
    &lt;h1&gt;Welcome, &lt;?= $userName ?&gt;!&lt;/h1&gt;
    &lt;p&gt;This is a protected page.&lt;/p&gt;
    &lt;a href="logout.php"&gt;Logout&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                <div class="thinking-card">
                    <p style="font-size: 0.75em;"><strong>Best practice:</strong> Create an <code>auth.php</code> file with this check and include it at the top of every protected page.</p>
                </div>
            </section>

            <section>
                <h2>Logout</h2>
                <pre style="font-size: 0.5em;"><code class="php">&lt;?php // logout.php
session_start();

// Unset all session variables
$_SESSION = [];

// Delete the session cookie
if (isset($_COOKIE[session_name()])) {
    setcookie(session_name(), '', time() - 3600, '/');
}

// Destroy the session
session_destroy();

// Redirect to login page
header('Location: login.php');
exit();
?&gt;</code></pre>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; font-size: 0.55em; margin-top: 1rem;">
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <code>$_SESSION = []</code><br>
                        <span style="color: #64748b;">Clear variables</span>
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <code>setcookie(...)</code><br>
                        <span style="color: #64748b;">Delete cookie</span>
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <code>session_destroy()</code><br>
                        <span style="color: #64748b;">End session</span>
                    </div>
                </div>
            </section>

            <!-- Authorization -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-user-lock" style="color: #dc2626;"></i> Authorization</h2>
                <p style="font-size: 0.85em;">Controlling what users can do</p>
            </section>

            <section>
                <h2>Role-Based Access Control</h2>
                <pre style="font-size: 0.45em;"><code class="php">&lt;?php
// auth.php - Reusable authentication/authorization functions

function isLoggedIn() {
    return isset($_SESSION['logged_in']) && $_SESSION['logged_in'] === true;
}

function isAdmin() {
    return isLoggedIn() && $_SESSION['user_role'] === 'admin';
}

function requireLogin() {
    if (!isLoggedIn()) {
        header('Location: login.php');
        exit();
    }
}

function requireAdmin() {
    requireLogin();  // Must be logged in first
    if (!isAdmin()) {
        http_response_code(403);
        die('Access denied. Admin privileges required.');
    }
}
?&gt;</code></pre>
            </section>

            <section>
                <h2>Using Authorization Checks</h2>
                <pre style="font-size: 0.45em;"><code class="php">&lt;?php // admin-panel.php
session_start();
require_once 'auth.php';

requireAdmin();  // Only admins can access this page

// Admin-only content here
?&gt;

&lt;?php // In navigation or templates ?&gt;
&lt;nav&gt;
    &lt;a href="dashboard.php"&gt;Dashboard&lt;/a&gt;
    &lt;a href="profile.php"&gt;Profile&lt;/a&gt;

    &lt;?php if (isAdmin()): ?&gt;
        &lt;a href="admin-panel.php"&gt;Admin Panel&lt;/a&gt;
        &lt;a href="manage-users.php"&gt;Manage Users&lt;/a&gt;
    &lt;?php endif; ?&gt;

    &lt;a href="logout.php"&gt;Logout&lt;/a&gt;
&lt;/nav&gt;</code></pre>
                <div class="thinking-card">
                    <p style="font-size: 0.75em;"><strong>Important:</strong> Always check permissions on the server side! Hiding links in the UI is not enough — users can directly access URLs.</p>
                </div>
            </section>

            <!-- OWASP Top 10 -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-bug" style="color: #dc2626;"></i> OWASP Top 10</h2>
                <p style="font-size: 0.85em;">Most critical web security risks</p>
            </section>

            <section>
                <h2>What is OWASP?</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.6em; margin-bottom: 1rem;">
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-info-circle"></i> About OWASP</h4>
                        <p style="margin: 0;"><strong>Open Web Application Security Project</strong></p>
                        <ul style="margin: 0.5rem 0 0 0; line-height: 1.6;">
                            <li>Non-profit foundation</li>
                            <li>Improves software security</li>
                            <li>Free resources and tools</li>
                            <li>Community-driven</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-list-ol"></i> Top 10 List</h4>
                        <p style="margin: 0;">Updated every few years</p>
                        <ul style="margin: 0.5rem 0 0 0; line-height: 1.6;">
                            <li>Most critical security risks</li>
                            <li>Based on real-world data</li>
                            <li>Industry standard reference</li>
                            <li>Current: OWASP Top 10 2021</li>
                        </ul>
                    </div>
                </div>
                <div class="thinking-card">
                    <p style="font-size: 0.75em;"><strong>Why it matters:</strong> Most security breaches exploit these common vulnerabilities. Know them, prevent them!</p>
                </div>
            </section>

            <section>
                <h2>OWASP Top 10 (2021)</h2>
                <div style="font-size: 0.55em; display: grid; grid-template-columns: 1fr 1fr; gap: 0.4rem;">
                    <div class="owasp-item">
                        <span class="owasp-num">1</span>
                        <div><strong>Broken Access Control</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">2</span>
                        <div><strong>Cryptographic Failures</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">3</span>
                        <div><strong>Injection</strong> (SQL, XSS, etc.)</div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">4</span>
                        <div><strong>Insecure Design</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">5</span>
                        <div><strong>Security Misconfiguration</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">6</span>
                        <div><strong>Vulnerable Components</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">7</span>
                        <div><strong>Auth & Session Failures</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">8</span>
                        <div><strong>Data Integrity Failures</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">9</span>
                        <div><strong>Logging & Monitoring Failures</strong></div>
                    </div>
                    <div class="owasp-item">
                        <span class="owasp-num">10</span>
                        <div><strong>Server-Side Request Forgery</strong></div>
                    </div>
                </div>
                <p style="font-size: 0.6em; color: #64748b; margin-top: 0.75rem;">We'll focus on the most relevant ones for PHP web development.</p>
            </section>

            <!-- SQL Injection -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-database" style="color: #dc2626;"></i> SQL Injection</h2>
                <p style="font-size: 0.85em;">OWASP #3: Injection Attacks</p>
            </section>

            <section>
                <h2>SQL Injection Attack</h2>
                <pre style="font-size: 0.48em;"><code class="php">// VULNERABLE CODE - Never do this!
$email = $_POST['email'];  // Attacker enters: ' OR '1'='1' --
$password = $_POST['password'];

$sql = "SELECT * FROM users WHERE email = '$email' AND password = '$password'";
// Becomes:
// SELECT * FROM users WHERE email = '' OR '1'='1' --' AND password = '...'
// The -- comments out the rest. '1'='1' is always true!
// Attacker logs in without valid credentials!</code></pre>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.6em; margin-top: 1rem;">
                    <div class="attack-card">
                        <h4 style="margin: 0 0 0.3rem 0; color: #f87171;"><i class="fas fa-skull"></i> What Attackers Can Do</h4>
                        <ul style="margin: 0; line-height: 1.5; color: #e2e8f0;">
                            <li>Bypass authentication</li>
                            <li>Read entire database</li>
                            <li>Modify or delete data</li>
                            <li>Execute admin operations</li>
                        </ul>
                    </div>
                    <div class="defense-card">
                        <h4 style="margin: 0 0 0.3rem 0; color: #22c55e;"><i class="fas fa-shield-alt"></i> Prevention</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li><strong>Prepared statements</strong></li>
                            <li>Parameterized queries</li>
                            <li>Input validation</li>
                            <li>Least privilege DB accounts</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h2>SQL Injection Prevention</h2>
                <pre style="font-size: 0.5em;"><code class="php">&lt;?php
// SAFE - Always use prepared statements!

// PDO with named parameters
$stmt = $pdo->prepare("SELECT * FROM users WHERE email = :email");
$stmt->execute([':email' => $_POST['email']]);

// PDO with positional parameters
$stmt = $pdo->prepare("SELECT * FROM users WHERE email = ? AND status = ?");
$stmt->execute([$_POST['email'], 'active']);

// The user input is ALWAYS treated as data, never as SQL code
// Even if attacker enters: ' OR '1'='1' --
// It searches for a user with that literal email address
?&gt;</code></pre>
                <div class="success-card">
                    <p style="font-size: 0.75em;"><strong><i class="fas fa-check-circle"></i> Rule:</strong> NEVER concatenate user input into SQL queries. ALWAYS use prepared statements with parameter binding.</p>
                </div>
            </section>

            <!-- XSS -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-code" style="color: #dc2626;"></i> Cross-Site Scripting (XSS)</h2>
                <p style="font-size: 0.85em;">OWASP #3: Injection Attacks</p>
            </section>

            <section>
                <h2>XSS Attack</h2>
                <pre style="font-size: 0.48em;"><code class="php">// VULNERABLE CODE
$name = $_POST['name'];  // Attacker enters: &lt;script&gt;alert('Hacked!')&lt;/script&gt;

echo "Hello, $name!";
// Outputs: Hello, &lt;script&gt;alert('Hacked!')&lt;/script&gt;!
// The script executes in the victim's browser!</code></pre>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.6em; margin-top: 1rem;">
                    <div class="attack-card">
                        <h4 style="margin: 0 0 0.3rem 0; color: #f87171;"><i class="fas fa-skull"></i> What Attackers Can Do</h4>
                        <ul style="margin: 0; line-height: 1.5; color: #e2e8f0;">
                            <li>Steal session cookies</li>
                            <li>Redirect users to malicious sites</li>
                            <li>Deface the website</li>
                            <li>Keylog user input</li>
                            <li>Perform actions as the user</li>
                        </ul>
                    </div>
                    <div class="defense-card">
                        <h4 style="margin: 0 0 0.3rem 0; color: #22c55e;"><i class="fas fa-shield-alt"></i> Prevention</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li><strong>htmlspecialchars()</strong></li>
                            <li>Content Security Policy</li>
                            <li>HTTPOnly cookies</li>
                            <li>Input validation</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h2>XSS Prevention</h2>
                <pre style="font-size: 0.5em;"><code class="php">&lt;?php
// SAFE - Always escape output!
$name = $_POST['name'];  // Even if: &lt;script&gt;alert('Hacked!')&lt;/script&gt;

// htmlspecialchars converts special characters to HTML entities
echo "Hello, " . htmlspecialchars($name, ENT_QUOTES, 'UTF-8') . "!";
// Outputs: Hello, &amp;lt;script&amp;gt;alert('Hacked!')&amp;lt;/script&amp;gt;!
// Displayed as text, NOT executed!

// Create a helper function
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

// Usage in templates
echo "Welcome, " . e($user['name']);
?&gt;

&lt;!-- In HTML templates --&gt;
&lt;p&gt;Hello, &lt;?= htmlspecialchars($name, ENT_QUOTES, 'UTF-8') ?&gt;!&lt;/p&gt;</code></pre>
            </section>

            <!-- CSRF -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-exchange-alt" style="color: #dc2626;"></i> Cross-Site Request Forgery</h2>
                <p style="font-size: 0.85em;">CSRF Attacks</p>
            </section>

            <section>
                <h2>CSRF Attack</h2>
                <div style="font-size: 0.6em; margin-bottom: 1rem;">
                    <p>Attacker tricks user's browser into making unwanted requests</p>
                </div>
                <pre style="font-size: 0.45em;"><code class="html">&lt;!-- Malicious website contains hidden form --&gt;
&lt;img src="https://bank.com/transfer?to=attacker&amount=1000" /&gt;

&lt;!-- Or a hidden form that auto-submits --&gt;
&lt;form action="https://yoursite.com/delete-account" method="POST" id="csrf-form"&gt;
    &lt;input type="hidden" name="confirm" value="yes"&gt;
&lt;/form&gt;
&lt;script&gt;document.getElementById('csrf-form').submit();&lt;/script&gt;</code></pre>
                <div class="warning-card" style="margin-top: 1rem;">
                    <p style="font-size: 0.75em;"><strong><i class="fas fa-exclamation-triangle"></i> The danger:</strong> If user is logged into your site and visits the attacker's page, their browser sends the request with their valid session cookie!</p>
                </div>
            </section>

            <section>
                <h2>CSRF Prevention</h2>
                <pre style="font-size: 0.42em;"><code class="php">&lt;?php
// Generate CSRF token (store in session)
function generateCsrfToken() {
    if (empty($_SESSION['csrf_token'])) {
        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
    }
    return $_SESSION['csrf_token'];
}

// Validate CSRF token
function validateCsrfToken($token) {
    return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);
}
?&gt;

&lt;!-- Include token in every form --&gt;
&lt;form method="POST" action="delete-account.php"&gt;
    &lt;input type="hidden" name="csrf_token" value="&lt;?= generateCsrfToken() ?&gt;"&gt;
    &lt;button type="submit"&gt;Delete Account&lt;/button&gt;
&lt;/form&gt;

&lt;?php
// Validate on form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (!validateCsrfToken($_POST['csrf_token'] ?? '')) {
        die('Invalid CSRF token');
    }
    // Process the form...
}
?&gt;</code></pre>
            </section>

            <!-- Security Best Practices -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-clipboard-check" style="color: #dc2626;"></i> Security Best Practices</h2>
                <p style="font-size: 0.85em;">Summary and checklist</p>
            </section>

            <section>
                <h2>Input Validation</h2>
                <pre style="font-size: 0.48em;"><code class="php">&lt;?php
// Validate and sanitize ALL user input

// Email validation
$email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);
if (!$email) die('Invalid email');

// Integer validation
$id = filter_var($_GET['id'], FILTER_VALIDATE_INT);
if ($id === false) die('Invalid ID');

// Whitelist validation (best for limited options)
$allowed_types = ['user', 'admin', 'moderator'];
$role = $_POST['role'];
if (!in_array($role, $allowed_types)) die('Invalid role');

// String sanitization
$name = trim($_POST['name']);
$name = htmlspecialchars($name, ENT_QUOTES, 'UTF-8');

// URL validation
$url = filter_var($_POST['website'], FILTER_VALIDATE_URL);
?&gt;</code></pre>
            </section>

            <section>
                <h2>Secure Session Configuration</h2>
                <pre style="font-size: 0.48em;"><code class="php">&lt;?php
// Set secure session settings BEFORE session_start()

ini_set('session.cookie_httponly', 1);  // No JS access to cookie
ini_set('session.cookie_secure', 1);    // HTTPS only (production)
ini_set('session.use_strict_mode', 1);  // Reject uninitialized session IDs
ini_set('session.cookie_samesite', 'Strict');  // CSRF protection

session_start();

// Regenerate session ID on login (prevent session fixation)
session_regenerate_id(true);

// Set session timeout
$_SESSION['last_activity'] = time();

// Check timeout on each request
if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity'] > 1800)) {
    session_unset();
    session_destroy();
    header('Location: login.php?timeout=1');
    exit();
}
$_SESSION['last_activity'] = time();
?&gt;</code></pre>
            </section>

            <section>
                <h2>Security Checklist</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.55em;">
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-database"></i> Database</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ Use prepared statements</li>
                            <li>✓ Least privilege DB accounts</li>
                            <li>✓ Never expose DB errors</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-key"></i> Passwords</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ Use password_hash()</li>
                            <li>✓ Require strong passwords</li>
                            <li>✓ Never store plain text</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-code"></i> Output</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ Use htmlspecialchars()</li>
                            <li>✓ Set Content-Type headers</li>
                            <li>✓ Escape all user data</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-user-shield"></i> Sessions</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ HTTPOnly cookies</li>
                            <li>✓ Regenerate on login</li>
                            <li>✓ Implement timeout</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-file-alt"></i> Forms</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ CSRF tokens</li>
                            <li>✓ Validate all input</li>
                            <li>✓ Rate limiting</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-server"></i> Server</h4>
                        <ul style="margin: 0; line-height: 1.6;">
                            <li>✓ Use HTTPS</li>
                            <li>✓ Hide PHP version</li>
                            <li>✓ Disable error display</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h2>Error Handling for Production</h2>
                <pre style="font-size: 0.48em;"><code class="php">&lt;?php
// DEVELOPMENT - Show errors (php.ini or runtime)
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// PRODUCTION - Hide errors, log them instead
ini_set('display_errors', 0);
ini_set('log_errors', 1);
ini_set('error_log', '/path/to/error.log');
error_reporting(E_ALL);

// Custom error page
set_exception_handler(function($e) {
    error_log($e->getMessage());  // Log the real error
    http_response_code(500);
    include 'error-500.html';     // Show generic message
    exit();
});
?&gt;</code></pre>
                <div class="warning-card">
                    <p style="font-size: 0.75em;"><strong><i class="fas fa-exclamation-triangle"></i> Never show detailed errors in production!</strong> They reveal file paths, database structure, and code — goldmine for attackers.</p>
                </div>
            </section>

            <!-- Summary -->
            <section data-background-color="#f8fafc">
                <h2><i class="fas fa-check-circle" style="color: #dc2626;"></i> Module Summary</h2>
            </section>

            <section>
                <h2>What We Covered</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.6em;">
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-id-card"></i> Authentication</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li>Password hashing (bcrypt)</li>
                            <li>Login/logout flow</li>
                            <li>Session management</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-user-shield"></i> Authorization</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li>Role-based access control</li>
                            <li>Permission checking</li>
                            <li>Protected routes</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-bug"></i> Common Attacks</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li>SQL Injection</li>
                            <li>Cross-Site Scripting (XSS)</li>
                            <li>CSRF Attacks</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; text-align: left;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #dc2626;"><i class="fas fa-shield-alt"></i> Best Practices</h4>
                        <ul style="margin: 0; line-height: 1.5;">
                            <li>Input validation</li>
                            <li>Output escaping</li>
                            <li>Secure configuration</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h2>Key Takeaways</h2>
                <div style="font-size: 0.7em; text-align: left; max-width: 750px; margin: 0 auto;">
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-shield-alt" style="color: #dc2626; margin-top: 0.2rem;"></i>
                        <div><strong>Never trust user input</strong> — validate, sanitize, escape</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-shield-alt" style="color: #dc2626; margin-top: 0.2rem;"></i>
                        <div><strong>Use prepared statements</strong> — prevent SQL injection</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-shield-alt" style="color: #dc2626; margin-top: 0.2rem;"></i>
                        <div><strong>Hash passwords with password_hash()</strong> — never store plain text</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 0.6rem;">
                        <i class="fas fa-shield-alt" style="color: #dc2626; margin-top: 0.2rem;"></i>
                        <div><strong>Escape output with htmlspecialchars()</strong> — prevent XSS</div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="fas fa-shield-alt" style="color: #dc2626; margin-top: 0.2rem;"></i>
                        <div><strong>Use CSRF tokens</strong> — protect state-changing actions</div>
                    </div>
                </div>
                <div class="thinking-card" style="margin-top: 1rem;">
                    <p style="font-size: 0.75em;"><strong>Remember:</strong> Security is not a feature — it's a requirement. Build it in from the start!</p>
                </div>
            </section>

            <section>
                <h2>Course Complete!</h2>
                <div style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); padding: 1.5rem; border-radius: 12px; margin: 1rem 0;">
                    <h3 style="margin: 0 0 0.5rem 0;"><i class="fas fa-graduation-cap" style="color: #22c55e;"></i> Congratulations!</h3>
                    <p style="margin: 0; font-size: 0.8em;">You've completed all 7 modules of CS381 - Web Application Development</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; font-size: 0.5em; margin-top: 1rem;">
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-globe" style="color: #2563eb;"></i><br>
                        Foundations
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fab fa-html5" style="color: #e34f26;"></i><br>
                        HTML5
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fab fa-css3-alt" style="color: #1572b6;"></i><br>
                        CSS
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fab fa-js" style="color: #f7df1e;"></i><br>
                        JavaScript
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fab fa-php" style="color: #8b5cf6;"></i><br>
                        PHP
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-database" style="color: #f59e0b;"></i><br>
                        MySQL
                    </div>
                    <div style="background: #f8fafc; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-shield-alt" style="color: #dc2626;"></i><br>
                        Security
                    </div>
                    <div style="background: #dcfce7; padding: 0.5rem; border-radius: 0.5rem; text-align: center;">
                        <i class="fas fa-check" style="color: #22c55e;"></i><br>
                        <strong>Done!</strong>
                    </div>
                </div>
            </section>

            <!-- End Slide -->
            <section data-background-color="#dc2626">
                <h2 style="color: white;">Questions?</h2>
                <p style="color: rgba(255,255,255,0.8);">Module 7: Authentication, Authorization & Security</p>
                <p style="color: rgba(255,255,255,0.6); font-size: 0.6em; margin-top: 2em;">CS381 - Web Application Development<br>Yanbu Industrial College</p>
            </section>

        </div>
    </div>

    <!-- Reveal.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/highlight.min.js"></script>

    <script>
        Reveal.initialize({
            hash: true,
            slideNumber: 'c/t',
            showSlideNumber: 'all',
            plugins: [ RevealHighlight ]
        });
    </script>
</body>
</html>
